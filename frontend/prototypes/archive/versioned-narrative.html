<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Versioned Narrative - Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .diff-add { background: #dcfce7; }
        .diff-remove { background: #fee2e2; text-decoration: line-through; }
        .version-line::before {
            content: '';
            position: absolute;
            left: 7px;
            top: 24px;
            bottom: -8px;
            width: 2px;
            background: #e2e8f0;
        }
        .version-line:last-child::before { display: none; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <span class="text-xl font-bold text-indigo-600">HERE.news</span>
            </div>
            <div class="flex items-center gap-2">
                <span class="px-2 py-1 bg-amber-100 text-amber-700 rounded text-sm">Live</span>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-6">
        <!-- Event Title with Version -->
        <div class="mb-6">
            <div class="flex items-center gap-2 mb-2">
                <span class="px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded-full uppercase">Fire</span>
                <span class="text-slate-400 text-sm">Nov 26, 2024</span>
            </div>

            <div class="flex items-center gap-3 mb-2">
                <h1 class="text-3xl font-bold text-slate-900">Wang Fuk Court Fire</h1>

                <!-- Version Badge - Clickable -->
                <button onclick="toggleVersionPanel()"
                        class="flex items-center gap-2 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors">
                    <span class="text-sm font-medium text-slate-700">v14</span>
                    <span class="text-xs text-slate-500">¬∑</span>
                    <span class="text-xs text-amber-600 font-medium">3 pending</span>
                    <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
            </div>

            <p class="text-slate-600">Deadly high-rise fire in Hong Kong's Tai Po district</p>
        </div>

        <!-- Two Pane Layout -->
        <div class="flex gap-6">
            <!-- LEFT: Narrative -->
            <div class="flex-1 min-w-0">
                <!-- Current Narrative -->
                <div class="bg-white rounded-xl border border-slate-200 overflow-hidden">
                    <div class="px-5 py-3 border-b border-slate-100 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-medium text-slate-700">Current Narrative</span>
                            <span class="text-xs text-slate-400">v14 ¬∑ Updated 2 hours ago</span>
                        </div>
                        <button onclick="showProposeModal()"
                                class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">
                            Propose Edit
                        </button>
                    </div>

                    <div class="p-5 space-y-4">
                        <!-- Section 1 -->
                        <div class="prose prose-slate max-w-none">
                            <h3 class="text-lg font-semibold text-slate-800 mb-2">The Incident</h3>
                            <p class="text-slate-600 leading-relaxed">
                                A devastating fire broke out at the Wang Fuk Court public housing estate in Tai Po
                                on November 26, 2024, killing at least 17 people and injuring over 50 others.
                                The blaze, which started around 11pm, spread rapidly through scaffolding and
                                protective netting on the building's exterior during renovation work.
                            </p>
                        </div>

                        <!-- Section 2 - Has pending CR -->
                        <div class="prose prose-slate max-w-none relative">
                            <div class="absolute -left-3 top-0 w-1 h-full bg-amber-400 rounded"></div>
                            <h3 class="text-lg font-semibold text-slate-800 mb-2 flex items-center gap-2">
                                Investigation
                                <span class="text-xs px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded">1 pending change</span>
                            </h3>
                            <p class="text-slate-600 leading-relaxed">
                                Hong Kong Chief Executive John Lee announced a judge-led independent committee
                                to investigate the fire. Police have arrested 13 individuals connected to the
                                renovation project on suspicion of manslaughter. The Independent Commission
                                Against Corruption is also examining potential graft related to the project.
                            </p>
                        </div>

                        <!-- Section 3 -->
                        <div class="prose prose-slate max-w-none">
                            <h3 class="text-lg font-semibold text-slate-800 mb-2">Safety Concerns</h3>
                            <p class="text-slate-600 leading-relaxed">
                                Residents had raised safety concerns about the building since last year.
                                Authorities allege that the construction company, Hong Yip Service Co. Ltd.,
                                used materials that failed to meet fire safety standards. The Labour Department
                                received complaints about scaffolding netting quality in September.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT: Context & Activity -->
            <div class="w-96 flex-shrink-0 space-y-4">
                <!-- Version Panel (toggleable) -->
                <div id="version-panel" class="bg-white rounded-xl border border-slate-200 overflow-hidden hidden">
                    <div class="px-4 py-3 bg-gradient-to-r from-slate-50 to-slate-100 border-b flex items-center justify-between">
                        <h3 class="font-semibold text-slate-800">Version History</h3>
                        <div class="flex gap-1">
                            <button onclick="showTab('history')" id="tab-history"
                                    class="text-xs px-2 py-1 rounded bg-slate-200 text-slate-700">History</button>
                            <button onclick="showTab('pending')" id="tab-pending"
                                    class="text-xs px-2 py-1 rounded text-slate-500 hover:bg-slate-100">Pending (3)</button>
                        </div>
                    </div>

                    <!-- History Tab -->
                    <div id="content-history" class="p-4 max-h-80 overflow-y-auto">
                        <div class="space-y-3">
                            <!-- Version entries -->
                            <div class="version-line relative pl-6">
                                <div class="absolute left-0 top-1 w-4 h-4 rounded-full bg-indigo-500 flex items-center justify-center">
                                    <span class="text-white text-xs">14</span>
                                </div>
                                <div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm font-medium text-slate-700">System update</span>
                                        <span class="text-xs text-slate-400">2h ago</span>
                                    </div>
                                    <p class="text-xs text-slate-500">Added ICAC investigation details from new sources</p>
                                </div>
                            </div>

                            <div class="version-line relative pl-6">
                                <div class="absolute left-0 top-1 w-4 h-4 rounded-full bg-green-500 flex items-center justify-center">
                                    <span class="text-white text-xs">13</span>
                                </div>
                                <div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm font-medium text-slate-700">@HKWatcher</span>
                                        <span class="text-xs text-slate-400">5h ago</span>
                                    </div>
                                    <p class="text-xs text-slate-500">Corrected arrest count from 11 to 13</p>
                                </div>
                            </div>

                            <div class="version-line relative pl-6">
                                <div class="absolute left-0 top-1 w-4 h-4 rounded-full bg-slate-300 flex items-center justify-center">
                                    <span class="text-white text-xs">12</span>
                                </div>
                                <div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm font-medium text-slate-700">System update</span>
                                        <span class="text-xs text-slate-400">1d ago</span>
                                    </div>
                                    <p class="text-xs text-slate-500">Synthesized 15 new claims from international sources</p>
                                </div>
                            </div>

                            <div class="version-line relative pl-6">
                                <div class="absolute left-0 top-1 w-4 h-4 rounded-full bg-slate-300 flex items-center justify-center">
                                    <span class="text-white text-xs">11</span>
                                </div>
                                <div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm font-medium text-slate-700">@LocalReporter</span>
                                        <span class="text-xs text-slate-400">2d ago</span>
                                    </div>
                                    <p class="text-xs text-slate-500">Added safety complaint details from Labour Dept</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Tab -->
                    <div id="content-pending" class="p-4 max-h-80 overflow-y-auto hidden">
                        <div class="space-y-3">
                            <!-- CR 1 -->
                            <div class="p-3 bg-amber-50 border border-amber-200 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-slate-700">CR #47</span>
                                    <span class="text-xs text-amber-600">Correction</span>
                                </div>
                                <p class="text-sm text-slate-600 mb-2">
                                    "Death toll should specify 'at least 17 confirmed' - some sources report higher"
                                </p>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-slate-400">by @FactChecker ¬∑ 3h ago</span>
                                    <div class="flex gap-1">
                                        <button class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200">Review</button>
                                    </div>
                                </div>
                            </div>

                            <!-- CR 2 -->
                            <div class="p-3 bg-indigo-50 border border-indigo-200 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-slate-700">CR #46</span>
                                    <span class="text-xs text-indigo-600">System</span>
                                </div>
                                <p class="text-sm text-slate-600 mb-2">
                                    "3 new claims available about government response from Reuters, BBC"
                                </p>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-slate-400">auto-generated ¬∑ 4h ago</span>
                                    <div class="flex gap-1">
                                        <button class="text-xs px-2 py-1 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200">View Diff</button>
                                    </div>
                                </div>
                            </div>

                            <!-- CR 3 -->
                            <div class="p-3 bg-purple-50 border border-purple-200 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-slate-700">CR #45</span>
                                    <span class="text-xs text-purple-600">Reframe</span>
                                </div>
                                <p class="text-sm text-slate-600 mb-2">
                                    "Suggest more neutral framing for 'authorities allege' - implies doubt"
                                </p>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-slate-400">by @NeutralNews ¬∑ 6h ago</span>
                                    <div class="flex gap-1">
                                        <button class="text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded hover:bg-purple-200">Review</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Change Request Detail (shown when reviewing) -->
                <div id="cr-detail" class="bg-white rounded-xl border border-slate-200 overflow-hidden hidden">
                    <div class="px-4 py-3 bg-gradient-to-r from-amber-50 to-yellow-50 border-b">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-slate-800">CR #47: Correction</h3>
                            <button onclick="hideCRDetail()" class="text-slate-400 hover:text-slate-600">‚úï</button>
                        </div>
                    </div>
                    <div class="p-4 space-y-4">
                        <div>
                            <div class="text-xs text-slate-500 uppercase tracking-wide mb-1">Proposed by</div>
                            <div class="text-sm text-slate-700">@FactChecker ¬∑ 3 hours ago</div>
                        </div>

                        <div>
                            <div class="text-xs text-slate-500 uppercase tracking-wide mb-1">Reason</div>
                            <p class="text-sm text-slate-600">
                                Multiple sources report different death tolls (17-160). Should clarify this is
                                the confirmed count, not final.
                            </p>
                        </div>

                        <div>
                            <div class="text-xs text-slate-500 uppercase tracking-wide mb-2">Diff</div>
                            <div class="text-sm p-3 bg-slate-50 rounded-lg font-mono">
                                <span class="diff-remove">killing at least 17 people</span>
                                <br>
                                <span class="diff-add">killing at least 17 confirmed dead, with some reports suggesting higher tolls</span>
                            </div>
                        </div>

                        <div>
                            <div class="text-xs text-slate-500 uppercase tracking-wide mb-1">Sources cited</div>
                            <div class="flex flex-wrap gap-1">
                                <span class="text-xs px-2 py-0.5 bg-slate-100 text-slate-600 rounded">Reuters</span>
                                <span class="text-xs px-2 py-0.5 bg-slate-100 text-slate-600 rounded">SCMP</span>
                            </div>
                        </div>

                        <div class="flex gap-2 pt-2 border-t border-slate-100">
                            <button class="flex-1 py-2 bg-green-500 hover:bg-green-600 text-white text-sm rounded-lg">
                                Approve
                            </button>
                            <button class="flex-1 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm rounded-lg">
                                Request Changes
                            </button>
                            <button class="py-2 px-3 bg-red-100 hover:bg-red-200 text-red-700 text-sm rounded-lg">
                                Reject
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Contributors -->
                <div class="bg-white rounded-xl border border-slate-200 overflow-hidden">
                    <div class="px-4 py-3 border-b border-slate-100">
                        <h3 class="font-semibold text-slate-800">Contributors</h3>
                    </div>
                    <div class="p-4">
                        <div class="flex items-center gap-2 mb-3">
                            <div class="flex -space-x-2">
                                <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white text-xs border-2 border-white">AI</div>
                                <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white text-xs border-2 border-white">HK</div>
                                <div class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-white text-xs border-2 border-white">LR</div>
                                <div class="w-8 h-8 rounded-full bg-slate-300 flex items-center justify-center text-slate-600 text-xs border-2 border-white">+4</div>
                            </div>
                            <span class="text-sm text-slate-500">7 contributors</span>
                        </div>
                        <div class="text-xs text-slate-400">
                            System (8 edits) ¬∑ @HKWatcher (3) ¬∑ @LocalReporter (2) ¬∑ others (1)
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-xl border border-slate-200 overflow-hidden">
                    <div class="px-4 py-3 border-b border-slate-100">
                        <h3 class="font-semibold text-slate-800">Contribute</h3>
                    </div>
                    <div class="p-4 space-y-2">
                        <button onclick="showProposeModal()"
                                class="w-full py-2 px-3 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 text-sm rounded-lg text-left flex items-center gap-2">
                            <span>‚úèÔ∏è</span> Propose an edit
                        </button>
                        <button class="w-full py-2 px-3 bg-amber-50 hover:bg-amber-100 text-amber-700 text-sm rounded-lg text-left flex items-center gap-2">
                            <span>üìé</span> Add a source
                        </button>
                        <button class="w-full py-2 px-3 bg-purple-50 hover:bg-purple-100 text-purple-700 text-sm rounded-lg text-left flex items-center gap-2">
                            <span>üí¨</span> Suggest reframing
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Propose Edit Modal -->
    <div id="propose-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl w-full max-w-lg mx-4 overflow-hidden">
            <div class="px-5 py-4 border-b border-slate-200 flex items-center justify-between">
                <h3 class="font-semibold text-slate-800">Propose an Edit</h3>
                <button onclick="hideProposeModal()" class="text-slate-400 hover:text-slate-600">‚úï</button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Type</label>
                    <select class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm">
                        <option>Correction - Fix factual error</option>
                        <option>Addition - Add missing context</option>
                        <option>Reframe - Suggest neutral wording</option>
                        <option>Remove - Delete inaccurate content</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Section</label>
                    <select class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm">
                        <option>The Incident</option>
                        <option>Investigation</option>
                        <option>Safety Concerns</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Current text (select what to change)</label>
                    <textarea class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm h-20"
                              placeholder="Paste the text you want to change..."></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Proposed text</label>
                    <textarea class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm h-20"
                              placeholder="Your suggested replacement..."></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Reason & sources</label>
                    <textarea class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm h-16"
                              placeholder="Why this change? Link to sources if applicable..."></textarea>
                </div>
            </div>
            <div class="px-5 py-4 border-t border-slate-200 flex justify-end gap-2">
                <button onclick="hideProposeModal()"
                        class="px-4 py-2 text-sm text-slate-600 hover:bg-slate-100 rounded-lg">
                    Cancel
                </button>
                <button class="px-4 py-2 text-sm bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg">
                    Submit Change Request
                </button>
            </div>
        </div>
    </div>

    <script>
        function toggleVersionPanel() {
            const panel = document.getElementById('version-panel');
            panel.classList.toggle('hidden');
        }

        function showTab(tab) {
            document.getElementById('content-history').classList.toggle('hidden', tab !== 'history');
            document.getElementById('content-pending').classList.toggle('hidden', tab !== 'pending');
            document.getElementById('tab-history').classList.toggle('bg-slate-200', tab === 'history');
            document.getElementById('tab-history').classList.toggle('text-slate-700', tab === 'history');
            document.getElementById('tab-history').classList.toggle('text-slate-500', tab !== 'history');
            document.getElementById('tab-pending').classList.toggle('bg-slate-200', tab === 'pending');
            document.getElementById('tab-pending').classList.toggle('text-slate-700', tab === 'pending');
            document.getElementById('tab-pending').classList.toggle('text-slate-500', tab !== 'pending');
        }

        function showProposeModal() {
            document.getElementById('propose-modal').classList.remove('hidden');
        }

        function hideProposeModal() {
            document.getElementById('propose-modal').classList.add('hidden');
        }

        function hideCRDetail() {
            document.getElementById('cr-detail').classList.add('hidden');
        }

        // Show CR detail when clicking Review
        document.querySelectorAll('button').forEach(btn => {
            if (btn.textContent === 'Review') {
                btn.addEventListener('click', () => {
                    document.getElementById('cr-detail').classList.remove('hidden');
                });
            }
        });
    </script>
</body>
</html>
