# ðŸ“ Directory Structure - Clarified

## Current Confusion

You have:
1. âœ… `backend/` - Python backend (intelligence engine)
2. âœ… `app/` - Python API layer (routers, cleaned up)
3. â“ `frontend/` - Simple HTML files (event viewer, timeline, map)
4. â“ `../webapp/frontend/` - Vite + Lit web components app

**Question**: Where should the React frontend go?

---

## âœ… **RECOMMENDED STRUCTURE**

```
service_farm/
â”‚
â”œâ”€â”€ backend/                 # Python intelligence engine
â”‚   â”œâ”€â”€ models/              # Domain models (Event, Page, User, etc.)
â”‚   â”œâ”€â”€ repositories/        # Data access (asyncpg)
â”‚   â”œâ”€â”€ services/            # Business logic
â”‚   â”œâ”€â”€ workers/             # Background processors
â”‚   â”œâ”€â”€ middleware/          # Auth (OAuth, JWT)
â”‚   â””â”€â”€ api/                 # Some backend API routes
â”‚
â”œâ”€â”€ app/                     # Python API layer (NOT FRONTEND!)
â”‚   â”œâ”€â”€ models/              # Pydantic API models
â”‚   â”œâ”€â”€ routers/             # FastAPI route handlers
â”‚   â””â”€â”€ services/            # App-specific services
â”‚
â”œâ”€â”€ frontend/                # â† MAIN FRONTEND (React/Vite from webapp)
â”‚   â”œâ”€â”€ src/                 # React source code
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ frontend-legacy/         # â† Archive of current HTML tools
â”‚   â”œâ”€â”€ index.html           # (moved from frontend/)
â”‚   â”œâ”€â”€ event.html
â”‚   â”œâ”€â”€ timeline.html
â”‚   â””â”€â”€ map.html
â”‚
â”œâ”€â”€ static/                  # â† Built frontend output (from `npm run build`)
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ assets/
â”‚
â””â”€â”€ main.py                  # Unified FastAPI app
```

---

## ðŸŽ¯ **WHAT GOES WHERE**

### `backend/` - Intelligence Engine (Python)
**Purpose**: Data processing, workers, repositories
**Contains**:
- Domain models (dataclasses)
- Repositories (asyncpg)
- Workers (extraction, knowledge, event)
- Services (Neo4j, event formation)
- Middleware (auth)

### `app/` - API Layer (Python)
**Purpose**: HTTP API endpoints for frontend
**Contains**:
- API route handlers (FastAPI routers)
- Pydantic request/response models
- Services that routers use

**NOT for**: Frontend code! `app/` is backend API layer.

### `frontend/` - Main UI (JavaScript/TypeScript)
**Purpose**: User interface (React, Vue, Lit, whatever framework)
**Contains**:
- React components
- Pages
- Routing
- State management
- API client code

**Source code** lives here, gets built to `static/`

### `frontend-legacy/` - Archive (HTML)
**Purpose**: Keep old HTML visualization tools
**Contains**:
- Simple HTML pages (event viewer, timeline, map)
- Useful for quick debugging/testing
- Not the main app

### `static/` - Production Build (Generated)
**Purpose**: Compiled frontend served by FastAPI
**Contains**:
- Minified JS bundles
- CSS
- index.html
- Assets (images, fonts)

**Generated by**: `cd frontend && npm run build`

---

## ðŸš€ **EXECUTION PLAN**

### Step 1: Preserve Current Frontend
```bash
cd service_farm
mv frontend frontend-legacy
echo "âœ… Preserved HTML tools in frontend-legacy/"
```

### Step 2: Copy Webapp Frontend
```bash
cp -r ../webapp/frontend ./frontend
echo "âœ… Copied webapp React app to frontend/"
```

### Step 3: Configure Build
```bash
cd frontend

# Update vite.config.ts to output to ../static/
cat > vite.config.ts <<EOF
import { defineConfig } from 'vite'
import { resolve } from 'path'

export default defineConfig({
  build: {
    outDir: '../static',
    emptyOutDir: true
  },
  server: {
    proxy: {
      '/api': 'http://localhost:8000'
    }
  }
})
EOF
```

### Step 4: Install & Build
```bash
npm install
npm run build
# Outputs to ../static/
```

---

## ðŸ“Š **COMPARISON**

| Directory | Purpose | Language | When Used |
|-----------|---------|----------|-----------|
| `backend/` | Data processing | Python | Always (workers, repos) |
| `app/` | API endpoints | Python | Always (HTTP handlers) |
| `frontend/` | UI source code | TypeScript/React | Development |
| `static/` | Built UI | HTML/JS/CSS | Production |
| `frontend-legacy/` | Old tools | HTML | Archive/debug |

---

## ðŸ”„ **DEVELOPMENT WORKFLOW**

### Development (Hot Reload)
```bash
# Terminal 1: Backend
python main.py              # Port 8000

# Terminal 2: Frontend
cd frontend
npm run dev                 # Port 5173 (proxies API to 8000)
```

### Production (Single Server)
```bash
# Build frontend
cd frontend
npm run build               # â†’ ../static/

# Run backend (serves static/)
cd ..
python main.py              # Serves frontend from /static/
```

---

## âŒ **WRONG APPROACHES**

### DON'T: Put React in `app/`
```
âŒ app/frontend/  - WRONG! app/ is for Python API layer
```

### DON'T: Mix frontend frameworks
```
âŒ frontend/react/
âŒ frontend/vue/
Choose ONE framework for frontend/
```

### DON'T: Serve from `frontend/` directly
```
âŒ main.py serving from frontend/ - Source code shouldn't be served
âœ… main.py serving from static/ - Built code should be served
```

---

## âœ… **CORRECT MENTAL MODEL**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Browser                            â”‚
â”‚  http://localhost:8000                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  main.py (FastAPI)                       â”‚
â”‚  - Serves /static/ for HTML/JS/CSS       â”‚
â”‚  - Handles /api/* for backend calls      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚staticâ”‚      â”‚app/      â”‚
    â”‚      â”‚      â”‚routers/  â”‚
    â”‚Built â”‚      â”‚(API      â”‚
    â”‚from  â”‚      â”‚handlers) â”‚
    â”‚front-â”‚      â”‚          â”‚
    â”‚end/  â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”˜           â”‚
                       â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚backend/  â”‚
                  â”‚repos,    â”‚
                  â”‚workers,  â”‚
                  â”‚services  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¯ **SUMMARY**

| Question | Answer |
|----------|--------|
| Where does React go? | `frontend/` |
| What about current HTML files? | Move to `frontend-legacy/` |
| Where does built code go? | `static/` |
| What is `app/` for? | Python API routes (NOT frontend) |
| Can I reuse HTML tools? | Yes, from `frontend-legacy/` |

**Next command to run:**
```bash
mv frontend frontend-legacy && cp -r ../webapp/frontend ./frontend
```
