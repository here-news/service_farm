# 74 â€” App Audit

## Current Structure Analysis

### ðŸ”´ DUPLICATE - Remove (use backend/ instead)
```
app/auth/                    â†’ USE: backend/middleware/
  - google_oauth.py          â†’ backend/middleware/google_oauth.py
  - session.py               â†’ backend/middleware/jwt_session.py
  - middleware.py            â†’ backend/middleware/auth.py
```

### ðŸ”´ DEPRECATED - Remove (replaced by unified main.py)
```
app/main.py                  â†’ REPLACED by: main.py (root)
```

### ðŸŸ¡ LEGACY ORM - Replace with backend repositories
```
app/database/
  - models.py                â†’ SQLAlchemy ORM (OLD)
  - connection.py            â†’ SQLAlchemy connection (OLD)
  - repositories/
    - user_repo.py           â†’ USE: backend/repositories/user_repository.py
    - comment_repo.py        â†’ USE: backend/repositories/comment_repository.py
    - chat_session_repo.py   â†’ USE: backend/repositories/chat_session_repository.py
    - event_submission_repo.py â†’ Keep? Or move to backend?
```

### ðŸŸ¢ KEEP - Pydantic API Models (different from domain models)
```
app/models/
  - user.py                  â†’ Pydantic models (UserCreate, UserResponse, etc.)
  - chat.py                  â†’ Pydantic models for chat API
  - event_submission.py      â†’ Pydantic models for event submissions
  - extraction.py            â†’ Pydantic models for extraction
```

### ðŸŸ¢ KEEP - API Routers (need to update to use backend/)
```
app/routers/
  - auth.py                  â†’ Update to use backend/middleware
  - comments.py              â†’ Update to use backend/repositories
  - chat.py                  â†’ Update to use backend/repositories
  - events.py                â†’ Update to use backend/repositories
  - story.py                 â†’ Modernize Story â†’ Event
  - event_page.py            â†’ Keep
  - coherence.py             â†’ Keep
  - extraction.py            â†’ Keep
  - preview.py               â†’ Keep
  - map.py                   â†’ Keep
```

### ðŸŸ¡ SERVICES - Review & Consolidate
```
app/services/
  - neo4j_client.py          â†’ Compare with backend/services/neo4j_service.py
  - tcf_feed_service.py      â†’ Keep if unique
  - coherence_service.py     â†’ Keep if unique
  - cache.py                 â†’ Keep if used
```

### ðŸŸ¡ CONFIG - Simplify
```
app/config.py                â†’ Simplify or merge with env vars
```

## Cleanup Actions

### Phase 1: Remove Duplicates
- [ ] Delete app/auth/ (use backend/middleware/)
- [ ] Delete app/main.py (use root main.py)

### Phase 2: Replace ORM with Repositories
- [ ] Update app/routers/ to import from backend/repositories/
- [ ] Remove app/database/models.py
- [ ] Remove app/database/repositories/
- [ ] Remove app/database/connection.py

### Phase 3: Consolidate Services
- [ ] Compare app/services/neo4j_client.py with backend/services/neo4j_service.py
- [ ] Keep unique services, remove duplicates

### Phase 4: Update Imports
- [ ] Fix all app/routers/ imports to use backend/
- [ ] Update Pydantic models if needed

### Phase 5: Clean Config
- [ ] Simplify app/config.py or remove entirely

## Expected Final Structure

```
service_farm/
â”œâ”€â”€ main.py                      # Unified entry point
â”œâ”€â”€ backend/                     # Intelligence engine
â”‚   â”œâ”€â”€ models/                  # Domain models (dataclasses)
â”‚   â”œâ”€â”€ repositories/            # asyncpg repositories
â”‚   â”œâ”€â”€ middleware/              # Auth system
â”‚   â””â”€â”€ services/                # Business logic
â””â”€â”€ app/                         # API layer (CLEANED)
    â”œâ”€â”€ models/                  # Pydantic API models ONLY
    â”œâ”€â”€ routers/                 # API route handlers (updated imports)
    â””â”€â”€ services/                # Unique app services only
```
